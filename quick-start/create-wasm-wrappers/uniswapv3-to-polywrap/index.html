<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Polywrap (Origin) Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Polywrap (Origin) Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-160302501-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160302501-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-160302501-1",{anonymize_ip:!0})</script><title data-react-helmet="true">Case study: Uniswap v3 Wrapper | Polywrap (Origin)</title><meta data-react-helmet="true" property="og:url" content="https://docs.polywrap.io/quick-start/create-wasm-wrappers/uniswapv3-to-polywrap"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Case study: Uniswap v3 Wrapper | Polywrap (Origin)"><meta data-react-helmet="true" name="description" content="The Uniswap v3 wrapper provides the same features as Uniswap&#x27;s JavaScript SDK, plus more. The wrapper is written in AssemblyScript and compiled to WebAssembly (WASM). Polywrap&#x27;s JavaScript Client makes interfacing with the wrapper as easy as interfacing with any ordinary JavaScript SDK."><meta data-react-helmet="true" property="og:description" content="The Uniswap v3 wrapper provides the same features as Uniswap&#x27;s JavaScript SDK, plus more. The wrapper is written in AssemblyScript and compiled to WebAssembly (WASM). Polywrap&#x27;s JavaScript Client makes interfacing with the wrapper as easy as interfacing with any ordinary JavaScript SDK."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.polywrap.io/quick-start/create-wasm-wrappers/uniswapv3-to-polywrap"><link data-react-helmet="true" rel="alternate" href="https://docs.polywrap.io/quick-start/create-wasm-wrappers/uniswapv3-to-polywrap" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.polywrap.io/quick-start/create-wasm-wrappers/uniswapv3-to-polywrap" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7d4bf121.css">
<link rel="preload" href="/assets/js/styles.2286fde4.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.9dcd93cf.js" as="script">
<link rel="preload" href="/assets/js/main.eff9ed67.js" as="script">
<link rel="preload" href="/assets/js/1.59924392.js" as="script">
<link rel="preload" href="/assets/js/2.955efa3a.js" as="script">
<link rel="preload" href="/assets/js/1be78505.4cbcde46.js" as="script">
<link rel="preload" href="/assets/js/c4f5d8e4.8767821b.js" as="script">
<link rel="preload" href="/assets/js/127.b5f905c8.js" as="script">
<link rel="preload" href="/assets/js/126.241c0c29.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.dd337427.js" as="script">
<link rel="preload" href="/assets/js/3.c1422c95.js" as="script">
<link rel="preload" href="/assets/js/125.5af51667.js" as="script">
<link rel="preload" href="/assets/js/17896441.0118ba59.js" as="script">
<link rel="preload" href="/assets/js/be4fcd68.e1016140.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/polywrap-logo-light.png" alt="Polywrap Icon" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/polywrap-logo.png" alt="Polywrap Icon" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Origin</strong></a><a href="https://polywrap.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Website</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Social</a><ul class="dropdown__menu"><li><a href="https://blog.polywrap.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link blog-logo" aria-label="Polywrap Blog">Blog</a></li><li><a href="https://twitter.com/polywrap_io" target="_blank" rel="noopener noreferrer" class="dropdown__link twitter-logo" aria-label="twitter account">Twitter</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://github.com/polywrap/monorepo" target="_blank" rel="noopener noreferrer" class="dropdown__link github-logo" aria-label="GitHub repository">Code</a></li><li><a href="https://discord.gg/Z5m88a5qWu" target="_blank" rel="noopener noreferrer" class="dropdown__link discord-logo" aria-label="Discord server">Chat</a></li><li><a href="https://snapshot.org/#/polywrap.eth" target="_blank" rel="noopener noreferrer" class="dropdown__link dao-logo" aria-label="dao repo">Govern</a></li><li><a href="https://handbook.polywrap.io" target="_blank" rel="noopener noreferrer" class="dropdown__link handbook-logo" aria-label="handbook">Handbook</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--checked react-toggle--disabled displayOnlyInLargeViewport_cxYs"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" checked="" class="react-toggle-screenreader-only"></div><div class="navbar__search"><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/polywrap-logo-light.png" alt="Polywrap Icon" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/polywrap-logo.png" alt="Polywrap Icon" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Origin</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://polywrap.io" target="_blank" rel="noopener noreferrer" class="menu__link">Website</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Social</a><ul class="menu__list"><li class="menu__list-item"><a href="https://blog.polywrap.io/" target="_blank" rel="noopener noreferrer" class="menu__link blog-logo" aria-label="Polywrap Blog">Blog</a></li><li class="menu__list-item"><a href="https://twitter.com/polywrap_io" target="_blank" rel="noopener noreferrer" class="menu__link twitter-logo" aria-label="twitter account">Twitter</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/polywrap/monorepo" target="_blank" rel="noopener noreferrer" class="menu__link github-logo" aria-label="GitHub repository">Code</a></li><li class="menu__list-item"><a href="https://discord.gg/Z5m88a5qWu" target="_blank" rel="noopener noreferrer" class="menu__link discord-logo" aria-label="Discord server">Chat</a></li><li class="menu__list-item"><a href="https://snapshot.org/#/polywrap.eth" target="_blank" rel="noopener noreferrer" class="menu__link dao-logo" aria-label="dao repo">Govern</a></li><li class="menu__list-item"><a href="https://handbook.polywrap.io" target="_blank" rel="noopener noreferrer" class="menu__link handbook-logo" aria-label="handbook">Handbook</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_lDyR"><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_MGa7"><div class="docItemContainer_PQH2"><article><header><h1 class="docTitle_z2YI">Case study: Uniswap v3 Wrapper</h1></header><div class="markdown"><p>The Uniswap v3 wrapper provides the same features as Uniswap&#x27;s JavaScript SDK, plus more. The wrapper is written in AssemblyScript and compiled to WebAssembly (WASM). Polywrap&#x27;s JavaScript Client makes interfacing with the wrapper as easy as interfacing with any ordinary JavaScript SDK.</p><p>This guide describes how we ported the Uniswap v3 JavaScript SDK to a Wasm wrapper. Reference documentation for the Uniswap v3 wrapper is available <a href="/demos/uniswapv3/intro">here</a>. This guide uses version <strong>0.0.1-prealpha.75</strong> of the Polywrap toolchain.</p><p>When writing the Uniswap v3 wrapper, our goal was to provide the same user experience as the SDK. The wrapper provides feature-parity, and the &quot;business logic&quot; is the same. We also ported elements of the Uniswap SDK Core package, as necessary, to implement the v3 wrapper.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="project-scaffolding"></a>Project scaffolding<a class="hash-link" href="#project-scaffolding" title="Direct link to heading">#</a></h2><p>The best way to set up a Polywrap project is to start with one of the project templates available in the Polywrap CLI. The <code>polywrap create</code> command lets you bootstrap your project structure without effort.</p><p>The initial project setup includes a <code>mutation</code> folder and a <code>query</code> folder within <code>src</code>, which correspond to the two types of modules a wrapper can have.</p><p>It also includes a <code>polywrap.yaml</code> manifest file, a <code>polywrap.build.yaml</code> Build Manifest file, and a <code>polywrap.meta.yaml</code> Meta Manifest file. The <code>polywrap.yaml</code> manifest tells the Polywrap CLI what language your wrapper is in, where your module schemas are located, and more. Our <code>polywrap.yaml</code> looked like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token key atrule">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> 0.0.1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">prealpha.5</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ./polywrap.build.yaml</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">meta</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ./polywrap.meta.yaml</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">language</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> wasm/assemblyscript</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">modules</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">mutation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">schema</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ./src/mutation/schema.graphql</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">module</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ./src/mutation/index.ts</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">schema</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ./src/query/schema.graphql</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">module</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ./src/query/index.ts</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The Build Manifest lets you customize the build process. The Meta Manifest lets you add meta-data to your project, like a description and a link to your repo.</p><p>For the Uniswap v3 wrapper, we left the <code>polywrap.yaml</code> manifest and the Build Manifest unchanged. We added detail to the Meta Manifest much later, when wrapper development was largely complete.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="writing-the-interface-in-a-graphql-schema"></a>Writing the interface in a GraphQL Schema<a class="hash-link" href="#writing-the-interface-in-a-graphql-schema" title="Direct link to heading">#</a></h2><p>We started by reading through the entire Uniswap v3 JavaScript SDK repo on GitHub to record all the types and methods we would reproduce, and to take note of their interactions. The interface of a Polywrap API is declared in a GraphQL schema. We wrote a schema type for each externally-facing class in the SDK, with properties that matched those in the class with public access. We wrote a method declaration in the schema for each externally-facing function and class method in the SDK. We even copied over the SDK&#x27;s inline documentation to fill the schema with context.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><div tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#An abridged look at our schema</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">ERC20-compliant token or Ether</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Token</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">Id of chain where token exists</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(156, 220, 254)">chainId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ChainId</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">Address of token&#x27;s ERC20 contract</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(156, 220, 254)">address</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token scalar">String</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">Token description</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(156, 220, 254)">currency</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Currency</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Query</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">Returns true if the tokens are equivalent, false otherwise</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(156, 220, 254)">tokenEquals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token attr-name" style="color:rgb(156, 220, 254)">tokenA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Token</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token attr-name" style="color:rgb(156, 220, 254)">tokenB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Token</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token scalar">Boolean</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">Returns true if the address of tokenA would precede the address of token B when sorted alphabetically</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(156, 220, 254)">tokenSortsBefore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token attr-name" style="color:rgb(156, 220, 254)">tokenA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Token</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token attr-name" style="color:rgb(156, 220, 254)">tokenB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Token</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token scalar">Boolean</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>A wrapper can have two modules: a <code>query</code> module and a <code>mutation</code> module. Each module has its own schema that, along with a an optional <code>common</code> schema for shared types, are combined at build time. The difference between mutations and queries is simple: mutations modify state--this typically means blockchain state in web3 applications--while queries do not. The Uniswap v3 SDK does not modify on-chain state, so all of its functionality was placed in the <code>query</code> module schema.</p><p>The first draft of the Uniswap v3 wrapper&#x27;s schema was written in just a few hours, though it was revised during development to fix mistakes and improve the user experience.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="implementing-the-first-functions"></a>Implementing the first functions<a class="hash-link" href="#implementing-the-first-functions" title="Direct link to heading">#</a></h2><p>When porting an SDK, it&#x27;s important to understand its project structure. The organization of the SDK&#x27;s source code can indicate how wrapper development should proceed. Development should allow for iterative changes and testing.</p><p>The Unsiwap v3 SDK can be mentally modularized into a roughly linear set of dependent components. We can start with the concept of a <code>Token</code>, which is the component of a <code>CurrencyAmount</code> and a <code>Pool</code>. A <code>Route</code> is a set of pools and currencies.  A <code>Trade</code> is constructed from two currency amounts and one or more routes. Based on this pattern, it made sense for us to start with <code>Token</code>.</p><p>In Uniswap&#x27;s JavaScript SDK, Token has properties like <code>chainId</code> and <code>address</code>, as well as two class methods: <code>equals</code> and <code>sortsBefore</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Methods found in the Token class in Uniswap&#x27;s SDK Core package</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">equals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">other</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Currency</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">isToken </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">this</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">chainId </span><span class="token operator" style="color:rgb(212, 212, 212)">===</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">chainId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">this</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address </span><span class="token operator" style="color:rgb(212, 212, 212)">===</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sortsBefore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">other</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Token</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">invariant</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">this</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">chainId </span><span class="token operator" style="color:rgb(212, 212, 212)">===</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">chainId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;CHAIN_IDS&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">invariant</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">this</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address </span><span class="token operator" style="color:rgb(212, 212, 212)">!==</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ADDRESSES&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">this</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">toLowerCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">toLowerCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Using the Polywrap CLI&#x27;s <code>codegen</code> command, we generated AssemblyScript classes corresponding to each type we defined in the schema. This was as simple as typing <code>polywrap codegen</code>. The classes work like TypeScript interfaces (statically typed JavaScript objects) that include some boilerplate serialization logic. When you declare a function in your schema that returns a custom type or accepts one as an argument, these generated classes are used as the AssemblyScript analogs.</p><p>The <code>codegen</code> command simultaneously generates another flavor of AssemblyScript class: function inputs. An <code>Input_*</code> class is generated for each function, where <code>*</code> is the name of the function. The classes have properties corresponding to the arguments defined in the schema. These <code>Input_*</code> classes are used as inputs to the functions declared in the GraphQL schema.</p><p>The Polywrap CLI places the generated files in directories named <code>w3</code>, which can be found within each module folder (as declared in your <code>polywrap.yaml</code> manifest). From there you can implement and use them.</p><p>Once we generated the classes, we imported the generated types and implemented the functions just as we found them in the Uniswap SDK. The function signatures match the schema definitions we declared earlier.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// An abridged copy of src/query/token.ts in the Uniswap v3 wrapper</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  Input_tokenEquals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  Input_tokenSortsBefore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  Token</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;./w3&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Checks if the current instance is equal to another (has an identical chainId and address).</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">tokenEquals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">input</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Input_tokenEquals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> tokenA</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Token </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> tokenB</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Token </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">tokenB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">chainId </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">chainId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Checks if the current instance sorts before another, by address.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">tokenSortsBefore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">input</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Input_tokenSortsBefore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> tokenA</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Token </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> tokenB</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Token </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">tokenB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> tokenAddress</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> tokenA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">toLowerCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> otherAddress</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">toLowerCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> tokenAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">localeCompare</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">otherAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>After implementing the token functions, it was possible to build the project (after commenting out methods in the schema that had not yet been implemented) and write the first automated tests.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="importing-plugins-and-wrappers"></a>Importing plugins and wrappers<a class="hash-link" href="#importing-plugins-and-wrappers" title="Direct link to heading">#</a></h2><p>The Uniswap v3 wrapper imports external dependencies to help it with certain tasks. A wrapper can import other wrappers or plugins.</p><p>One of the most important dependencies we used is Polywrap&#x27;s Ethereum plugin. The Ethereum plugin is based on the popular <code>ethers.js</code> package. It can be used to prepare and send Ethereum transactions in much the same way.</p><p>Although the Uniswap v3 JavaScript SDK does not include methods that mutate state on the Ethereum blockchain, several of its functions do return encoded Ethereum transaction calldata that can be sent to Uniswap&#x27;s on-chain smart contracts. The SDK uses <code>ethers.js</code> to encode calldata. We can do the same with the Ethereum plugin.</p><p>Our <code>src/query/schema.graphql</code> schema declares several imports at the top of the file. Among these is the Ethereum plugin, which is included in the Polywrap client by default.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><div tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#import { Query } into Ethereum from &quot;wrap://ens/ethereum.polywrap.eth&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#import { Query } into SHA3 from &quot;wrap://ens/sha3.polywrap.eth&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#import { Query } into ERC20 from &quot;wrap://ipfs/QmeiPWHe2ixfitcgjRwP5AaJD5R7DbsGhQNQwT4rFNyxx8&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#import { Query } into Subgraph from &quot;wrap://ipfs/QmcnrHegojMFqHkRhixazY67Zb9mSbMLv6sSxyDpUtnrQS&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#import { ChainId, TradeType, Currency, Token, Price, TokenAmount, Tick, Pool, FeeAmount, Route, TradeSwap, Trade, BestTradeOptions, Position, PermitOptions, FeeOptions, SwapOptions, MethodParameters, MintAmounts } from &quot;../common/schema.graphql&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Wrappers and plugins are queried at URIs. When a user wants to call an API function with the Polywrap Client, they use a URI to tell the Client which API they are calling. The URI&#x27;s are also used to import wrapper dependencies. Even though the Ethereum plugin is a JavaScript package that gets loaded into memory, it is still queried at a URI that is redirected and resolved to the in-memory instance.</p><p>Once imports are declared, we can run the <code>codegen</code> command of the Polywrap CLI to generate imported modules and types. The imported module class includes all of the methods declared in its own GraphQL schema. If we want to know what&#x27;s in it, we might look there first.</p><p>We used the Ethereum plugin&#x27;s <code>encodeFunction</code> method to encode calldata for Uniswap&#x27;s Multicall smart contract.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// An abridged copy of src/query/routerUtils.ts in the Uniswap v3 wrapper</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  Ethereum_Query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  Input_encodeMulticall</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;./w3&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">encodeMulticall</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">input</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Input_encodeMulticall</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> calldatas</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">calldatas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> calldatas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">length </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token plain"> calldatas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ethereum_Query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">encodeFunction</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        method</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;function multicall(bytes[] calldata data) external payable returns (bytes[] memory results)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        args</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;[&quot;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> calldatas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;, &quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;]&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">unwrap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="using-base-schema-types"></a>Using base schema types<a class="hash-link" href="#using-base-schema-types" title="Direct link to heading">#</a></h2><p>Polywrap schemas support additional default types beyond those found in standard GraphQL. The <code>BigInt</code> type is used in the Uniswap v3 wrapper to represent integers larger than 32 bits. Since Ethereum supports unsigned integers as large as 256 bits, we needed to support them as well.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><div tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">An amount of a token</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">TokenAmount</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">Token</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(156, 220, 254)">token</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Token</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token description string language-markdown" style="color:rgb(206, 145, 120)">Raw amount of the token, not adjusted for the token&#x27;s decimals</span><span class="token description string" style="color:rgb(206, 145, 120)">&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(156, 220, 254)">amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">BigInt</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The <code>BigInt</code> type looks like a standard GraphQL type in the schema. In AssemblyScript, the type is received as an instance of the <code>BigInt</code> class from in the <a href="https://github.com/polywrap/as-bigint" target="_blank" rel="noopener noreferrer">as-bigint</a> AssemblyScript package.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// compares two TokenAmount types for equality, returning true if they have the</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// same token and same amount</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">tokenAmountEquals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">input</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Input_tokenAmountEquals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> amtA</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> TokenAmount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">tokenAmountA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> amtB</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> TokenAmount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">tokenAmountB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">tokenEquals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> tokenA</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> amtA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> tokenB</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> amtB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">token </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    amtA</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">eq</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">amtB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Other base schema types include <code>BigNumber</code>, <code>JSON</code>, and <code>Map&lt;T,U&gt;</code>. These types, along with <code>BigInt</code>, can be imported directly into AssemblyScript modules from the <code>polywrap/wasm</code> package.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><p>We adapted all of the tests in Uniswap&#x27;s SDK to work with the wrapper. This ensured that the wrapper met at least the same standards of quality the Uniswap team expected of their SDK. The Uniswap team tested their SDK with artificial data that allowed them to calculate the expected results and compare those results to the outputs of their code. We used the same test cases and expected the same results from our wrapper.</p><p>We also wrote tests based on real-world data, using a fork of the Ethereum Mainnet network, to compare the results of our wrapper queries with results produced by the SDK. This helped us test the wrapper with input of greater complexity.</p><p>We wrote automated tests using two different testing frameworks: <code>as-pect</code> and <code>jest</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="assemblyscript-tests-with-as-pect"></a>AssemblyScript tests with as-pect<a class="hash-link" href="#assemblyscript-tests-with-as-pect" title="Direct link to heading">#</a></h3><p><code>as-pect</code> is an AssemblyScript testing framework, and that is why we used it. Unit tests written in the native language of the wrapper can be used to test classes and functions that are written to support the main wrapper code. This reduces the layers of complexity that would be associated with testing only the functions declared in our GraphQL schema.</p><p>For example, we wrote a <code>PriorityQueue</code> class to sort trades for the <code>bestTradeExactIn</code> and <code>bestTradeExactOut</code> functions. We used <code>as-pect</code> to test it. This simplified testing and debugging for<code>bestTradeExactIn</code> and <code>bestTradeExactOut</code>.</p><p>We wrote many of our other tests in <code>as-pect</code> as well, in part because it was straightforward to copy and paste test scripts from the Uniswap v3 SDK repo and adapt the syntax.</p><p>One quirk with <code>as-pect</code> is that the following must be added to its configuration file to get it working with Polywrap.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><div tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">imports</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  w3</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_invoke_args</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_invoke_result</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_invoke_error</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_subinvoke</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_subinvoke_result</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_subinvoke_result_len</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_subinvoke_error</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_subinvoke_error_len</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    __w3_abort</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> () =&gt; </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="end-to-end-tests-in-javascript-with-jest"></a>End-to-end tests in JavaScript with Jest<a class="hash-link" href="#end-to-end-tests-in-javascript-with-jest" title="Direct link to heading">#</a></h3><p>Not all tests can be written in the wrapper&#x27;s native language, nor should they be. Code that depends on other wrappers or plugins must be tested by making calls to the Polywrap Client. The Client coordinates inter-API communication.</p><p>We wrote many of our most important tests in the popular JavaScript framework <code>jest</code>. Were we to write the Uniswap v3 wrapper again, we would actually use a lot less <code>as-pect</code> and a lot more <code>jest</code>.</p><p>One advantage of testing with <code>jest</code> is that it requires developers to make calls in the same way users of their wrappers are likely to make them. A disadvantage is that it requires developers to set up the Polywrap client and a test environment, which is easy but takes more time.</p><p>You can learn how to set up a Polywrap test environment in JavaScript by reading <a href="/quick-start/test-wasm-wrappers/end-to-end-test">Write an end to end test</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="other-tips-for-testing-in-javascript"></a>Other tips for testing in JavaScript<a class="hash-link" href="#other-tips-for-testing-in-javascript" title="Direct link to heading">#</a></h3><p>The Polywrap CLI can automatically generate TypeScript types using the <code>polywrap app</code> command. The types mirror those declared in your GraphQL schema.</p><p>If you love brevity, you can write functions that &quot;wrap&quot; your wrapper calls. This can make your tests a bit easier to read.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><div tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// This function lets us call the createRoute function in the Uniswap v3 wrapper with one line of code</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">createRoute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">client</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> PolywrapClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ensUri</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pools</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> inToken</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Token</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> outToken</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Token</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">Promise</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Route</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">invoke</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">Route</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    uri</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ensUri</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    module</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;query&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    method</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;createRoute&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    input</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">      pools</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">      inToken</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">      outToken</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">throw</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">data</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// example usage</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> route_0_1</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Route </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">createRoute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ensUri</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">pool_0_1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> token0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> token1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="documentation"></a>Documentation<a class="hash-link" href="#documentation" title="Direct link to heading">#</a></h2><p>As a final touch, we generated ample documentation for the Uniswap v3 wrapper.</p><p>Polywrap&#x27;s GraphQL parser can read documentation comments (comments with triple quotes) from the wrapper&#x27;s GraphQL schema. Using this capability, Polywrap built a tool to help developers create documentation for their wrappers.</p><p>The Polywrap CLI will soon be able to use GraphQL schemas to automatically generate markdown that is compatible with popular documentation tools like Docusaurus. We tested the tool to generate the <a href="/demos/uniswapv3/intro">reference documentation for the Uniswap v3 wrapper</a>.</p></div></article><div class="margin-vert--xl"><div style="opacity:0;visibility:hidden"></div><div class="row"><div class="col"><a href="https://github.com/polywrap/documentation/tree/main/src/docs/quick-start/create-wasm-wrappers/uniswapv3-to-polywrap.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-scaffolding" class="table-of-contents__link">Project scaffolding</a></li><li><a href="#writing-the-interface-in-a-graphql-schema" class="table-of-contents__link">Writing the interface in a GraphQL Schema</a></li><li><a href="#implementing-the-first-functions" class="table-of-contents__link">Implementing the first functions</a></li><li><a href="#importing-plugins-and-wrappers" class="table-of-contents__link">Importing plugins and wrappers</a></li><li><a href="#using-base-schema-types" class="table-of-contents__link">Using base schema types</a></li><li><a href="#testing" class="table-of-contents__link">Testing</a><ul><li><a href="#assemblyscript-tests-with-as-pect" class="table-of-contents__link">AssemblyScript tests with as-pect</a></li><li><a href="#end-to-end-tests-in-javascript-with-jest" class="table-of-contents__link">End-to-end tests in JavaScript with Jest</a></li><li><a href="#other-tips-for-testing-in-javascript" class="table-of-contents__link">Other tips for testing in JavaScript</a></li></ul></li><li><a href="#documentation" class="table-of-contents__link">Documentation</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/styles.2286fde4.js"></script>
<script src="/assets/js/runtime~main.9dcd93cf.js"></script>
<script src="/assets/js/main.eff9ed67.js"></script>
<script src="/assets/js/1.59924392.js"></script>
<script src="/assets/js/2.955efa3a.js"></script>
<script src="/assets/js/1be78505.4cbcde46.js"></script>
<script src="/assets/js/c4f5d8e4.8767821b.js"></script>
<script src="/assets/js/127.b5f905c8.js"></script>
<script src="/assets/js/126.241c0c29.js"></script>
<script src="/assets/js/935f2afb.dd337427.js"></script>
<script src="/assets/js/3.c1422c95.js"></script>
<script src="/assets/js/125.5af51667.js"></script>
<script src="/assets/js/17896441.0118ba59.js"></script>
<script src="/assets/js/be4fcd68.e1016140.js"></script>
</body>
</html>