(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{114:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return c})),a.d(t,"toc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(3),r=(a(0),a(194)),o=a(199),l=a(200);const i={id:"infra-pipeline",title:"Configure Polywrap infrastructure pipeline"},c={unversionedId:"tutorials/test-wasm-wrappers/infra-pipeline",id:"tutorials/test-wasm-wrappers/infra-pipeline",isDocsHomePage:!1,title:"Configure Polywrap infrastructure pipeline",description:"The Polywrap CLI infra command interacts with an Infra Manfiest",source:"@site/docs/tutorials/test-wasm-wrappers/infra-pipeline.md",slug:"/tutorials/test-wasm-wrappers/infra-pipeline",permalink:"/tutorials/test-wasm-wrappers/infra-pipeline",editUrl:"https://github.com/polywrap/documentation/tree/main/src/docs/tutorials/test-wasm-wrappers/infra-pipeline.md",version:"current",sidebar:"docs",previous:{title:"Writing tests with TypeScript",permalink:"/tutorials/test-wasm-wrappers/end-to-end-test"},next:{title:"Configure Polywrap build pipeline",permalink:"/tutorials/build-and-deploy-wasm-wrappers/build-pipeline"}},s=[{value:"Declaration",id:"declaration",children:[]},{value:"Content",id:"content",children:[]},{value:"Infrastructure Modules",id:"infrastructure-modules",children:[{value:"Local",id:"local",children:[]},{value:"Remote",id:"remote",children:[]},{value:"Default",id:"default",children:[]}]}],u={toc:s};function p(e){let{components:t,...a}=e;return Object(r.b)("wrapper",Object(n.a)({},u,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"The Polywrap CLI ",Object(r.b)("a",{parentName:"p",href:"../../reference/cli/commands/infra"},Object(r.b)("inlineCode",{parentName:"a"},"infra"))," command interacts with an Infra Manfiest\n",Object(r.b)("inlineCode",{parentName:"p"},"polywrap.infra.yaml")," file to to help users manage local infrastructure for their wrappers.\nThe Infra Manifest declares environmental variables and infrastructure modules that describe the locations of\nlocal, remote, or default ",Object(r.b)("a",{parentName:"p",href:"https://docs.docker.com/compose/compose-file/"},"docker-compose")," files.\nThe Polywrap CLI ",Object(r.b)("a",{parentName:"p",href:"../../reference/cli/commands/infra"},Object(r.b)("inlineCode",{parentName:"a"},"infra"))," command reads the manifest and launches or halts\nmodules as directed by the user."),Object(r.b)("h2",{id:"declaration"},"Declaration"),Object(r.b)("p",null,"Unlike some manifests, the Infra Manifest does not need to be declared in your Polywrap manifest."),Object(r.b)("h2",{id:"content"},"Content"),Object(r.b)("p",null,"The Infra Manifest consists of environmental variable declarations and one or more infrastructure modules.\nEach module points to a local, remote, or default docker-compose file."),Object(r.b)(o.a,{defaultValue:"schema",values:[{label:"Schema",value:"schema"},{label:"Example",value:"example"}],mdxType:"Tabs"},Object(r.b)(l.a,{value:"schema",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-yaml"},"format: # The manifest format version\nenv: # Declare environmental variables here\nmodules:\n  myRemote: # A remote package with a docker-compose file\n    package: # Package name\n    version: # Package version\n    registry: # Package registry name\n    dockerComposePath: # (Optional) Path to docker-compose file in the package directory\n  myLocal: # A local package with a docker-compose file\n    path: # Path to the package\n  eth-ens-ipfs: default # A module available by default\n"))),Object(r.b)(l.a,{value:"example",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-yaml"},'format: 0.1.0\nenv:\n  IPFS_PORT: $ENV_IPFS_PORT\n  DEV_SERVER_PORT: 4040\n  DEV_SERVER_ETH_TESTNET_PORT: 8545\nmodules:\n  ipfs:\n    package: "@namestys/ipfs-infra"\n    version: "0.0.1"\n    registry: npm\n  dev-server:\n    path: ../local-packages/dev-server\n')))),Object(r.b)("h2",{id:"infrastructure-modules"},"Infrastructure Modules"),Object(r.b)("p",null,"An Infra Manifest can declare any number of infrastructure modules.\nPolywrap currently supports three types of infrastructure modules: "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"A local module exists on your local filesystem."),Object(r.b)("li",{parentName:"ul"},"A remote module is a package hosted by a package registry."),Object(r.b)("li",{parentName:"ul"},"The default module is included with the CLI.")),Object(r.b)("h3",{id:"local"},"Local"),Object(r.b)("p",null,"A local infrastructure module is a path from the Infra Manifest to a local folder with a docker-compose file."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-yaml",metastring:'title="Example: local module configuration"',title:'"Example:',local:!0,module:!0,'configuration"':!0},"format: 0.1.0\nmodules:\n  myLocal:\n    path: ../local-packages/myLocal\n")),Object(r.b)("h3",{id:"remote"},"Remote"),Object(r.b)("p",null,"A remote infrastructure module is a package hosted at a package registry.\nThe package must contain a docker-compose file.\nThe path to the docker-compose file must be declared in the Infra Manifest if the file is not located in the package root."),Object(r.b)("p",null,"Remote packages can be shared.\nUsers can add remote packages to their manifest to replicate the infrastructure modules defined by other users or projects."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-yaml",metastring:'title="Example: remote module configuration"',title:'"Example:',remote:!0,module:!0,'configuration"':!0},'format: 0.1.0\nmodules:\n  myIpfsNode:\n    package: "@namestys/ipfs-node"\n    version: "1.0.2"\n    registry: npm\n    dockerComposePath: ./config/docker-compose.yaml\n')),Object(r.b)("h3",{id:"default"},"Default"),Object(r.b)("p",null,"A default infrastructure module is included with the ",Object(r.b)("a",{parentName:"p",href:"../../reference/cli/polywrap-cli"},Object(r.b)("inlineCode",{parentName:"a"},"polywrap"))," CLI.\nIt is declared in the Infra Manifest as a module named ",Object(r.b)("em",{parentName:"p"},"eth-ens-ipfs")," and the value ",Object(r.b)("em",{parentName:"p"},"default"),"."),Object(r.b)("p",null,"If an Infra Manifest is not found, the Polywrap CLI ",Object(r.b)("a",{parentName:"p",href:"../../reference/cli/commands/infra"},Object(r.b)("inlineCode",{parentName:"a"},"infra"))," command can still use\nthis module.\nTo use the default module without an Infra Manifest, pass ",Object(r.b)("inlineCode",{parentName:"p"},"eth-ens-ipfs")," as an argument to the ",Object(r.b)("a",{parentName:"p",href:"../../reference/cli/commands/infra"},Object(r.b)("inlineCode",{parentName:"a"},"infra"))," command's ",Object(r.b)("inlineCode",{parentName:"p"},"modules")," option:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"npx polywrap infra up --modules=eth-ens-ipfs\n")),Object(r.b)("p",null,"The default infrastructure module defines a docker container with:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"A test server at http://localhost:",Object(r.b)("strong",{parentName:"li"},"4040")),Object(r.b)("li",{parentName:"ul"},"A Ganache Ethereum test network at http://localhost:",Object(r.b)("strong",{parentName:"li"},"8545")),Object(r.b)("li",{parentName:"ul"},"An IPFS node at http://localhost:",Object(r.b)("strong",{parentName:"li"},"5001"))),Object(r.b)("p",null,"It also sets up ENS smart contracts at initialization, so you can build wrappers and deploy them to an ENS registry\non your locally hosted testnet. The Ethereum address of the ENS registry is 0xe78A0F7E598Cc8b0Bb87894B0F60dD2a88d6a8Ab."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-yaml",metastring:'title="Example: local module configuration"',title:'"Example:',local:!0,module:!0,'configuration"':!0},"format: 0.1.0\nmodules:\n  eth-ens-ipfs: default\n")))}p.isMDXComponent=!0},194:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return f}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=r.a.createContext({}),u=function(e){var t=r.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=u(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=u(a),d=n,f=p["".concat(l,".").concat(d)]||p[d]||m[d]||o;return a?r.a.createElement(f,i(i({ref:t},s),{},{components:a})):r.a.createElement(f,i({ref:t},s))}));function f(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,l=new Array(o);l[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var s=2;s<o;s++)l[s]=a[s];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"},196:function(e,t,a){"use strict";function n(e){var t,a,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(r&&(r+=" "),r+=a);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,a=0,r="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}},197:function(e,t,a){"use strict";var n=a(0),r=a(198);t.a=function(){const e=Object(n.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},198:function(e,t,a){"use strict";var n=a(0);const r=Object(n.createContext)(void 0);t.a=r},199:function(e,t,a){"use strict";var n=a(0),r=a.n(n),o=a(197),l=a(196),i=a(57),c=a.n(i);const s=37,u=39;t.a=function(e){const{lazy:t,block:a,defaultValue:i,values:p,groupId:m,className:d}=e,{tabGroupChoices:f,setTabGroupChoices:b}=Object(o.a)(),[h,y]=Object(n.useState)(i),O=n.Children.toArray(e.children),g=[];if(null!=m){const e=f[m];null!=e&&e!==h&&p.some(t=>t.value===e)&&y(e)}const j=e=>{const t=e.target,a=g.indexOf(t),n=O[a].props.value;y(n),null!=m&&(b(m,n),setTimeout(()=>{(function(e){const{top:t,left:a,bottom:n,right:r}=e.getBoundingClientRect(),{innerHeight:o,innerWidth:l}=window;return t>=0&&r<=l&&n<=o&&a>=0})(t)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(c.a.tabItemActive),setTimeout(()=>t.classList.remove(c.a.tabItemActive),2e3))},150))},v=e=>{var t;let a;switch(e.keyCode){case u:{const t=g.indexOf(e.target)+1;a=g[t]||g[0];break}case s:{const t=g.indexOf(e.target)-1;a=g[t]||g[g.length-1];break}}null===(t=a)||void 0===t||t.focus()};return r.a.createElement("div",{className:"tabs-container"},r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(l.a)("tabs",{"tabs--block":a},d)},p.map(e=>{let{value:t,label:a}=e;return r.a.createElement("li",{role:"tab",tabIndex:h===t?0:-1,"aria-selected":h===t,className:Object(l.a)("tabs__item",c.a.tabItem,{"tabs__item--active":h===t}),key:t,ref:e=>g.push(e),onKeyDown:v,onFocus:j,onClick:j},a)})),t?Object(n.cloneElement)(O.filter(e=>e.props.value===h)[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},O.map((e,t)=>Object(n.cloneElement)(e,{key:t,hidden:e.props.value!==h}))))}},200:function(e,t,a){"use strict";var n=a(0),r=a.n(n);t.a=function(e){let{children:t,hidden:a,className:n}=e;return r.a.createElement("div",{role:"tabpanel",hidden:a,className:n},t)}}}]);